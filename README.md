[![Actions Status](https://github.com/lizmat/MoarVM-Profile/actions/workflows/linux.yml/badge.svg)](https://github.com/lizmat/MoarVM-Profile/actions) [![Actions Status](https://github.com/lizmat/MoarVM-Profile/actions/workflows/macos.yml/badge.svg)](https://github.com/lizmat/MoarVM-Profile/actions) [![Actions Status](https://github.com/lizmat/MoarVM-Profile/actions/workflows/windows.yml/badge.svg)](https://github.com/lizmat/MoarVM-Profile/actions)

NAME
====

MoarVM::Profile - Raku interface to MoarVM profiles

SYNOPSIS
========

```raku
use MoarVM::Profile;
my $profile = MoarVM::Profile("foo.sql");  # generated SQL
.say for $profile.routines.grep(*.is-user);
# 2: <unit-outer> (-e:1)
# 107: <unit> (-e:1)
# 112: (block) (-e:1)
# 113: foo (-e:1)
```

DESCRIPTION
===========

The `MoarVM::Profile` distribution provides a Raku interface for the information provided by the MoarVM/Rakudo code profiling information. It is intended to be used in generally applicable applications, but also for ad-hoc profiling situations and benchmarking.

MoarVM::Profile
===============

The main class provided by this distribution is the `MoarVM::Profile` class. Instantiation happens with the `.new` method, which either takes a SQL file (with the extension `.sql` as generated by the `--profile=foo.sql` argument) or a SQLite database file (with the `.db` extension.

Methods
-------

### types

Returns a `List` of `MoarVM::Profile::Type` objects, where the index of the object is the same as the `.id` of the object.

```raku
my $type := $profile.types[$type-id];
```

### routines

Returns a `List` of `MoarVM::Profile::Routine` objects, where the index of the object is the same as the `.id` of the object.

```raku
my $routine := $profile.routine[$routine-id];
```

MoarVM::Type
============

The `MoarVM::Type` object encapsulates the information about a type (class) that has been accessed at least once.

Methods
-------

### id

The numerical ID of the type in this profile.

### name

The name of the this type.

### extra-info

A `Map` with extra information about this type.

### type-links

A `Map` with extra information about this links to other types.

MoarVM::Routine
===============

The `MoarVM::Routine` object encapsulates the information about a block that has been executed at least once. A such, the name "Routine" is a bit of a misnomer, "Callable" would have been better probably. But the naming of these modules is following the names of the SQL tables provided, so "Routine" it is.

How the `MoarVM::Routine` object is created, is an implementation detail and as such not documented.

Methods
-------

### id

The numerical ID of the `Callable` in this profile.

### name

The name of the `Callable`, "(block)" if there is no name, implying this is some type of non-`Routine` `Callable`.

### file

The file in which the `Callable` has been defined. Note this can have special path indicators such as "SETTING::" and "NQP::", so there's no direct path to an actual file.

### line

The line number in which the `Callable` has been defined (if available). **-1** if no line number could be obtained (which is typical of some low level code blocks).

### is-block

Returns `True` if the `Callable` is not a `Routine`.

### is-core

Returns `True` if the `Callable` is part of the Rakudo core.

### is-user

Returns `True` if the `Callable` is user-supplied code.

### overview

Returns the `MoarVM:Profile::RoutineOverview` object associated with this `Callable`.

### spesh

Returns the `MoarVM:Profile::SpeshOverview` object associated with this `Callable`, if any.

MoarVM::Profile::RoutineOverview
================================

An object containing some summary information about a `MoarVM::Profile::Routine` object.

Methods
-------

  * id - ID of the associated M:P:Routine object

  * entries

  * inclusive-time

  * exclusive-time

  * spesh-entries

  * jit-entries

  * inlined-entries

  * osr

  * deopt-one

  * deopt-all

  * site-count

MoarVM::Profile::SpeshOverview
==============================

An object containing some spesh related information about a `MoarVM::Profile::Routine` object.

Methods
-------

  * id - ID of the associated M:P:Routine object

  * deopt-one

  * deopt-all

  * osr

  * entries

  * inlined-entries

  * spesh-entries

  * jit-entries

  * sites

CREDITS
=======

The SQL used in this module have been mostly copied from the [moarperf](https://github.com/timo/moarperf/blob/master/lib/ProfilerWeb.pm6) repository by *Timo Paulssen*.

AUTHOR
======

Elizabeth Mattijsen <liz@raku.rocks>

COPYRIGHT AND LICENSE
=====================

Copyright 2026 Elizabeth Mattijsen

This library is free software; you can redistribute it and/or modify it under the Artistic License 2.0.

